apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

configMapGenerator:
  - name: datadog-ami-age-check
    files:
      - eks_ami_age.py

resources:
  - ami_age_conf.yaml
  - datadog-agent.yaml

generatorOptions:
  disableNameSuffixHash: true

patches:
  - target:
      kind: ConfigMap
      name: datadog-ami-age-check
    patch: |-
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: datadog-ami-age-check
        annotations:
          argocd.argoproj.io/sync-wave: "0"

  - target:
      kind: DaemonSet
      name: datadog-agent
    patch: |-
      apiVersion: apps/v1
      kind: DaemonSet
      metadata:
        name: datadog-agent
        annotations:
          argocd.argoproj.io/sync-wave: "1"
